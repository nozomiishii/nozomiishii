# Refer for explanation to following link:
# https://github.com/evilmartians/lefthook/blob/master/docs/full_guide.md

pre-commit:
  parallel: true

  commands:
    format:
      # Markdown formatting is the responsibility of the markdownlint
      exclude: ".*\\.md$"
      run: npx -y prettier {staged_files} --ignore-unknown --ignore-path .gitignore --write

    lint-markdown:
      glob: '*.md'
      run: npx -y markdownlint-cli2 {staged_files}

    lint-textlint:
      glob: '*.md'
      run: npx -y textlint --fix {staged_files}

    generate-pdf-cv:
      files: git diff --name-only --staged
      glob: 'src/cv/cv-ja.md'
      run: npx -y md-to-pdf src/cv/cv-ja.md && git add src/cv/cv-ja.pdf

    generate-pdf-pay:
      files: git diff --name-only --staged
      glob: 'src/pay/pay-ja.md'
      run: npx -y md-to-pdf src/pay/pay-ja.md && git add src/pay/pay-ja.pdf

commit-msg:
  parallel: true

  commands:
    commitlint:
      run: npx -y commitlint --edit

  scripts:
    'spell-check.sh':
      runner: bash

post-merge:
  parallel: true

  commands:
    # If you have set 'git config pull.rebase true', use the 'post-rewrite' hook instead of the 'post-merge' hook.
    update-node-modules:
      files: git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD
      glob: '**/{package.json,yarn.lock}'
      run: yarn install

    delete-merged-branches:
      run: git branch --merged | grep -Ev '\*|master|main|dev|develop|development|stag|staging|prod|production' | xargs git branch -d; git fetch --prune;
